import{_ as H,k as b,D as G,G as L,g as x,c as d,o as c,a as o,t as A,h as N,F as B,i as F,v as P,l as K,d as z,N as q,b as J,I as Q,K as Z,j as ee,e as te}from"./Navigation-Dx91ZCbe.js";import{a as ne}from"./index-N8GIV6tk.js";import{f as ae,P as se,i as le}from"./axios_config-BOxkkDfg.js";const re={class:"timeline-wrapper"},oe={class:"year-label"},ie={key:0,class:"month-label"},ue=["onMouseenter"],ce=["href"],de={class:"tooltip-date"},ve=["href"],_e={__name:"YearTimeline",props:{year:{type:Number,default:new Date().getFullYear()},events_of_the_year:Array},setup(M){const y=M,h=b(null),T=b(null),C=b(null),{width:j}=ne(h),D=b(null),I=b(!1),S=b({}),m=b({});G(D,async i=>{if(i!==null){await L();const s=Array.isArray(T.value)?T.value[0]:T.value;if(s&&h.value){const t=s.getBoundingClientRect(),n=h.value.getBoundingClientRect();let e="50%",a="translateX(-50%)";t.left<n.left?(e="0",a="translateX(0)"):t.right>n.right&&(e="auto",a="translateX(0)",a=`translateX(calc(-50% - ${t.right-n.right}px))`),S.value={left:e,transform:a}}}else S.value={}}),G(I,async i=>{if(i){await L();const s=Array.isArray(C.value)?C.value[0]:C.value;if(s&&h.value){const t=s.getBoundingClientRect(),n=h.value.getBoundingClientRect();let e="50%",a="translateX(-50%)";if(t.left<n.left)e="0",a="translateX(0)";else if(t.right>n.right){const v=t.right-n.right;e="auto",a=`translateX(calc(-50% - ${v}px))`}m.value={left:e,transform:a}}}else m.value={}});const R=x(()=>{if(!y.events_of_the_year)return[];const i=y.year,s=new Date(i,0,1).getTime(),n=new Date(i+1,0,1).getTime()-s;return y.events_of_the_year.map(e=>{const[a,v,w]=e.date_start,[l,r,_]=e.date_end,u=new Date(a,v-1,w),k=new Date(l,r-1,_+1),$=(u.getTime()-s)/n*100,f=(k.getTime()-s)/n*100-$,g=e.was_held?"var(--event-active-saturation)":"var(--event-inactive-saturation)",p=`hsl(${e.hue}, ${g}, var(--event-lightness))`,V=e.ar_path&&Array.isArray(e.ar_path)?"/dea/event_detail/#/"+e.ar_path.join("/")+"/"+e.name:"#";return{name:e.name,raw_dates:e.raw_dates,link:V,startTime:u.getTime(),endTime:k.getTime(),startPct:$,widthPct:f,wrapperStyle:{left:`${$}%`,width:`${f}%`,minWidth:"10px"},barStyle:{backgroundColor:p}}})}),Y=x(()=>{const i=new Date;if(i.getFullYear()!==y.year)return null;const s=new Date(y.year,0,1).getTime(),n=new Date(y.year+1,0,1).getTime()-s,e=new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime(),a=e+24*60*60*1e3,v=(e-s)/n*100,w=(a-e)/n*100;return{leftPct:v,widthPct:w,label:`Today: ${i.getFullYear()}.${String(i.getMonth()+1).padStart(2,"0")}.${String(i.getDate()).padStart(2,"0")}`}}),X=x(()=>{if(D.value===null)return[];const i=R.value[D.value];if(!i)return[];const s=n=>{const e=n.startPct/100*j.value;let a=n.widthPct/100*j.value;return a<10&&(a=10),{start:e,end:e+a}},t=s(i);return R.value.filter(n=>{const e=s(n);return t.start<e.end&&t.end>e.start})}),E=x(()=>{const i=y.year,s=new Date(i,0,1).getTime(),n=new Date(i+1,0,1).getTime()-s,e=[];for(let a=0;a<=12;a++){const v=new Date(i,a,1),w=(v.getTime()-s)/n*100;let l="";a<12&&(l=v.toLocaleString("default",{month:"short"})),e.push({position:w,name:l,date:v})}return e});return(i,s)=>(c(),d("div",re,[o("div",oe,A(M.year),1),o("div",{class:"timeline-container",ref_key:"timelineContainer",ref:h},[s[5]||(s[5]=o("div",{class:"timeline-line"},null,-1)),(c(!0),d(B,null,F(E.value,(t,n)=>(c(),d("div",{key:n,class:"month-marker",style:P({left:t.position+"%"})},[s[3]||(s[3]=o("div",{class:"month-dot"},null,-1)),t.name?(c(),d("div",ie,A(t.name),1)):N("",!0)],4))),128)),(c(!0),d(B,null,F(R.value,(t,n)=>(c(),d("div",{key:"event-"+n,class:"event-wrapper",style:P(t.wrapperStyle),onMouseenter:e=>D.value=n,onMouseleave:s[0]||(s[0]=e=>D.value=null)},[o("a",{href:t.link,class:"event-bar",style:P(t.barStyle)},null,12,ce),D.value===n?(c(),d("div",{key:0,class:"event-tooltip",ref_for:!0,ref_key:"tooltipRef",ref:T,style:P(S.value)},[o("table",null,[o("tbody",null,[(c(!0),d(B,null,F(X.value,e=>(c(),d("tr",{key:e.name},[o("td",de,A(e.raw_dates),1),o("td",null,[o("a",{href:e.link,class:"tooltip-link"},A(e.name),9,ve)])]))),128))])])],4)):N("",!0)],44,ue))),128)),Y.value?(c(),d("div",{key:0,class:"today-wrapper",style:P({left:Y.value.leftPct+"%",width:Y.value.widthPct+"%"}),onMouseenter:s[1]||(s[1]=t=>I.value=!0),onMouseleave:s[2]||(s[2]=t=>I.value=!1)},[s[4]||(s[4]=o("div",{class:"today-bar"},null,-1)),I.value?(c(),d("div",{key:0,class:"today-tooltip",ref_key:"todayTooltipRef",ref:C,style:P(m.value)},A(Y.value.label),5)):N("",!0)],36)):N("",!0)],512)]))}},fe=H(_e,[["__scopeId","data-v-d654a88e"]]),pe={class:"ca-container"},ge={class:"ca-content"},he={key:0,class:"status-message"},ye={key:1,class:"status-message"},me={key:2},we={class:"legend-container"},ke=["id","onUpdate:modelValue"],be=["href"],De={style:{display:"flex",gap:"0.75em","align-items":"center","justify-content":"center","margin-top":"0.5em"}},$e={style:{color:"var(--grey-mild)","font-size":"0.95em","margin-left":"0.5em"}},Te={__name:"Calendar",setup(M){const y=b({}),h=b("loading"),T=b(new Date().getFullYear()),C=b(T.value);async function j(){ae({url:[se].concat("event_list_index.json").join("/"),axiosInstance:le,on_start:()=>{y.value={},h.value="loading"},on_success:t=>{y.value=t,h.value="loaded"},on_error:t=>{h.value="error"}})}function D(t){const n=t.dates||"";let e=null,a=null,v=!0;const w=/(\d{4})\.(\d{2})\.(\d{2})\s*-\s*(\d{4})\.(\d{2})\.(\d{2})/g,l=[...n.matchAll(w)];if(l.length>0){const r=l[l.length-1];e=[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],a=[parseInt(r[4]),parseInt(r[5]),parseInt(r[6])]}else{const r=/(\d{4})\.(\d{2})\.(\d{2})/g,_=[...n.matchAll(r)];if(_.length>0){const u=_[_.length-1];e=[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])],a=[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}}return n.toLowerCase().includes("cancelled")&&(v=!1),[e,a,v]}function I(t,n=[]){let e=[],a=Object.keys(t).filter(l=>l!=="@databases"&&l!=="@count");a.sort((l,r)=>l.localeCompare(r));let v=t["@databases"]||{};const w=Object.entries(v).sort(([,l],[,r])=>{const _=l&&l.aliases&&l.aliases[0]||"",u=r&&r.aliases&&r.aliases[0]||"";return _&&u?_.localeCompare(u):String(l&&l.key||"").localeCompare(String(r&&r.key||""))});for(const[l,r]of w){let _=n.concat([l]),u=r.aliases[0],k=_.join("/");e.push({key:l,name:u,ar_path:_,link:"/dea/event_group_detail/#/"+k,events:(r==null?void 0:r.events)||{}})}for(const l of a){const r=I(t[l],n.concat([l]));e=e.concat(r)}return e}const S=x(()=>{const t=I(y.value),n=t.length;return t.map((e,a)=>({...e,hue:n>0?360*a/n:0}))}),m=b({});G(S,t=>{if(t)for(const n of t)n.link in m.value||(m.value[n.link]=!0)},{immediate:!0});function R(t){const n=S.value||[];for(const e of n)m.value[e.link]=t}function Y(){R(!0)}function X(){R(!1)}const E=x(()=>{const t={},n=S.value;for(const e of n){if(m.value&&m.value[e.link]===!1)continue;const a=e.name,v=e.ar_path,w=e.hue,l=e.events,r=Object.entries(l).sort(([_,u],[k,$])=>{const[O]=D(u),[f]=D($);if(O&&f){for(let g=0;g<3;g++){const p=(O[g]||0)-(f[g]||0);if(p!==0)return p}return _.localeCompare(k)}else{if(O)return-1;if(f)return 1}return _.localeCompare(k)});for(const[_,u]of r){let[k,$,O]=D(u);if(k===null||$===null)continue;let f=k[0],g=$[0];if(f>g){console.warn(`Event "${_}" has start year greater than end year: ${f} > ${g}. Skipping.`);continue}if(f!==g)for(let p=f;p<=g;p++){t.hasOwnProperty(p)||(t[p]=[]);let V=p===f?k:[p,1,1],U=p===g?$:[p,12,31],W={name:_,raw_dates:u.dates||"",date_start:V,date_end:U,was_held:O,ar_path:v,event_group_name:a,hue:w};t[p].push(W)}else{t.hasOwnProperty(f)||(t[f]=[]);let p={name:_,raw_dates:u.dates||"",date_start:k,date_end:$,was_held:O,ar_path:v,event_group_name:a,hue:w};t[f].push(p)}(T.value===null||f<T.value)&&(T.value=f),(C.value===null||g>C.value)&&(C.value=g)}}return t}),i=x(()=>S.value.map(t=>({name:t.name,hue:t.hue,link:t.link,path:t.ar_path.join("/")}))),s=x(()=>{const t=E.value||{};return Object.values(t).reduce((n,e)=>n+(Array.isArray(e)?e.length:0),0)});return K(async()=>{await j()}),(t,n)=>(c(),d(B,null,[n[4]||(n[4]=o("head",null,[o("title",null,"dea | Calendar")],-1)),o("div",pe,[o("div",ge,[n[1]||(n[1]=o("section",{id:"top"},null,-1)),z(q),n[2]||(n[2]=o("div",{class:"header-title"},"Calendar",-1)),n[3]||(n[3]=o("div",{class:"header"},"Calendar of events in the database.",-1)),h.value==="loading"?(c(),d("div",he," Fetching event list... ")):h.value==="error"?(c(),d("div",ye,[n[0]||(n[0]=J(" Failed to fetch event list. ")),o("button",{class:"retry-button",onClick:j,title:"Retry fetching event list."}," Retry ")])):(c(),d("div",me,[o("div",we,[(c(!0),d(B,null,F(i.value,e=>(c(),d("div",{key:e.path,class:"legend-item"},[Q(o("input",{type:"checkbox",id:"legend-"+e.path,"onUpdate:modelValue":a=>m.value[e.link]=a,class:"legend-checkbox",style:P({backgroundColor:m.value[e.link]?`hsl(${e.hue}, var(--event-active-saturation), var(--event-lightness))`:"transparent",borderColor:`hsl(${e.hue}, var(--event-active-saturation), var(--event-lightness))`}),title:"Toggle visibility"},null,12,ke),[[Z,m.value[e.link]]]),o("a",{href:e.link,class:"legend-text"},A(e.name),9,be)]))),128))]),o("div",De,[o("button",{class:"retry-button",onClick:Y}," Show all "),o("button",{class:"retry-button",onClick:X}," Show none "),o("span",$e," Showing "+A(s.value)+" events ",1)]),(c(!0),d(B,null,F(Object.keys(E.value).sort((e,a)=>a-e),e=>(c(),d("div",{key:e},[z(fe,{year:parseInt(e),events_of_the_year:E.value[e]},null,8,["year","events_of_the_year"])]))),128))]))])])],64))}},Ce={__name:"App",setup(M){return(y,h)=>(c(),ee(Te))}};te(Ce).mount("#app");
