import{_ as G,j as ae,o as l,w as ne,a as t,c as i,h as g,b as S,t as m,F as E,i as B,u as U,k as f,g as F,n as re,l as le,d as T,I as ce,J as ie,q as z,v as oe,s as ue,x as de,N as ve,e as pe}from"./Navigation-Dx91ZCbe.js";import{u as _e}from"./index-N8GIV6tk.js";import{m as me,f as fe,P as N,i as W,c as he}from"./axios_config-BOxkkDfg.js";import{P as ge,T as xe,a as ye}from"./PopUpGeneric-DVD7e6OH.js";const ke={class:"popup-circle-div"},be={class:"cd-aliases"},Ce={class:"cd-event"},Le=["href"],we={key:0,class:"cd-misc"},Pe={class:"cd-ul-descriptions"},$e=["innerHTML"],Ee={__name:"PopUpCirclePartialdetails",props:{circle_db:{type:Object,required:!0},db_path:{type:Array,required:!0}},setup(x){return(L,d)=>(l(),ae(ge,{onClose:d[0]||(d[0]=k=>L.$emit("close")),title:`Circle Partial Details: ${x.circle_db.names[0]||"undefined"}`},{default:ne(()=>{var k,p;return[t("div",ke,[t("p",be,[d[1]||(d[1]=t("span",{class:"info-name"},"Names:",-1)),S(" "+m((p=(k=x.circle_db)==null?void 0:k.names)==null?void 0:p.join(" / ")),1)]),t("p",Ce,[d[2]||(d[2]=t("span",{class:"info-name"},"Event:",-1)),S(" "+m()+" ",1),t("a",{class:"cd-event-link",href:["/dea/event_detail/#"].concat(x.circle_db.ar_path).join("/")},m(x.circle_db.event_name),9,Le)]),x.circle_db.hasOwnProperty("misc")&&x.circle_db.misc.length>0?(l(),i("div",we,[d[3]||(d[3]=t("span",{class:"info-name"},"Misc:",-1)),t("ul",Pe,[(l(!0),i(E,null,B(x.circle_db.misc,(M,I)=>(l(),i("span",{key:I},[(l(!0),i(E,null,B(M.split(`
`),(b,C)=>(l(),i("li",{key:C},[t("span",{innerHTML:U(me)(b)},null,8,$e)]))),128))]))),128))])])):g("",!0),d[4]||(d[4]=t("p",null,"Note: search results matches for any fields described above.",-1)),d[5]||(d[5]=t("p",null,"For more details, please refer to event detail page.",-1))])]}),_:1},8,["title"]))}},Ae=G(Ee,[["__scopeId","data-v-79b522a1"]]),je={key:0},Ue={key:1},Se={key:0,class:"status-message"},Te={key:1,class:"status-message"},Me={key:2,class:"status-message"},Ie={key:3,class:"status-message"},Re={key:4,class:"status-message"},De={key:5,class:"status-message"},Fe={key:6,class:"status-message"},Ne={key:7,class:"status-message"},Be={key:8,class:"status-message"},He={class:"load-controls-row status-message"},Oe={class:"load-controls-left"},Ve=["title"],qe=["title"],ze={class:"load-controls-right"},We={class:"cp-div"},Ge={class:"cp-search-row",style:{"margin-bottom":"0.5em"}},Je={class:"cp-input cp-regex-group"},Ke={class:"cp-results"},Xe={class:"cp-vlist"},Ye={class:"cp-row-inner"},Qe={class:"cp-row-col cp-row-col-names"},Ze=["onClick"],et={class:"cp-row-col cp-row-col-event"},tt=["href"],st=180,at={__name:"CircleParticipation",setup(x){const L=f(""),d=f("");let k=null;const p=f({}),M=f([]),I=f([]),b=f([]),C=f([]),a=f(["Idle"]),P=f(!1);async function H(){fe({url:[N].concat(["circle_index_metadata.json"]).join("/"),axiosInstance:W,on_start:()=>{p.value={},a.value=["Loading"]},on_success:s=>{p.value=s,a.value=["Loaded"]},on_error:s=>{a.value=["Error"]}})}async function A(s){var v,h;let e="",_=0,n=null,c=null;if(s=="compact")n=M,c=b,e=[N].concat(["circle_participation_compact_index"]).join("/"),_=((v=p.value)==null?void 0:v.compact_index_chunk_count)||0,a.value=["cLoading",0];else if(s=="extensive")n=I,c=C,e=[N].concat(["circle_participation_extensive_index"]).join("/"),_=((h=p.value)==null?void 0:h.extensive_index_chunk_count)||0,a.value=["eLoading",0];else{console.error("fetch_circle_raw_indexes: Unknown variant",s);return}n.value=[],n.value.length>0&&console.log(`Retrying from ${n.value.length} / ${_} for ${s} index.`);for(let r=n.value.length;r<_;r++){let u=`${e}_${r}.json`;try{const y=await W.get(u,{responseType:"json"});a.value[1]=r+1,console.log(`NEW FETCHED: (${u})`),n.value.push(y.data)}catch(y){a.value=[s=="compact"?"cError":"eError"],console.error("Error fetching data:",y);return}}a.value=[s=="compact"?"cParsing":"eParsing",0],await he(10),c.value=[];for(let r=0;r<n.value.length;r++)c.value=c.value.concat(O(n.value[r],[],s)),a.value[1]=r+1;try{R.value=J(c.value)}catch(r){console.error("Error building search index:",r),R.value=[]}a.value=[s=="compact"?"cLoaded":"eLoaded"]}function O(s,e=[],_="compact"){let n=[];for(const c in s)if(Array.isArray(s[c])){let v=[];D.value[c]=e.concat(c);for(const h in s[c]){let r=s[c][h],u=_=="extensive"?r:{names:r};u.event_name=c,v.push(u)}n=[].concat(n,v)}else{let v=O(s[c],e.concat(c),_);n=[].concat(n,v)}return n}const V=F(()=>{if(!P.value)return null;const s=L.value;if(!s||s.length===0)return null;try{return new RegExp(s,"i")}catch{return null}}),$=F(()=>a.value[0]==="cLoaded"&&b&&b.value&&Array.isArray(b.value)?b.value:a.value[0]==="eLoaded"&&C&&C.value&&Array.isArray(C.value)?C.value:[]),R=f([]),D=f({});function J(s){return!s||!Array.isArray(s)?[]:s.map(e=>{const _=(e.event_name||"").toString().trim(),n=Array.isArray(e.names)?e.names.map(v=>v.toString().trim()).join(" / "):(e.names||"").toString().trim(),c=Array.isArray(e.misc)?e.misc.map(v=>v.toString().trim()).join(" / "):(e.misc||"").toString().trim();return[_,n,c].filter(Boolean).join("	").toLowerCase()})}const w=F(()=>{if(!$||!$.value||!Array.isArray($.value))return[];const s=L.value.trim().toLowerCase();return!s&&!P.value?$.value:$.value.filter((e,_)=>{const n=(R.value[_]||"").toString();return P.value?!s||!V.value?!1:V.value.test(n):n.includes(s)})}),{list:K,containerProps:X,wrapperProps:Y,scrollTo:Q}=_e(w,{itemHeight:22});function Z(s){const e=s.target.value;d.value=e,k&&clearTimeout(k),k=setTimeout(()=>{L.value=e,Q(0)},st)}function ee(){if(!w||!w.value||w.value.length===0)return;const s=w.value||[];function e(u){return u==null?"":`"${String(u).replace(/"/g,'""').replace(/\t/g,"\\t").replace(/\r?\n/g,"\\n")}"`}const n=[["event_name","names","misc"].join("	")];for(const u of s){const y=u.event_name??"",j=Array.isArray(u.names)?u.names.join(" / "):u.names??"",o=Array.isArray(u.misc)?u.misc.join(" / "):u.misc??"";n.push([e(y),e(j),e(o)].join("	"))}const c=n.join(`\r
`),v=new Blob(["\uFEFF",c],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(v),r=document.createElement("a");r.href=h,r.download="circle_search_dump.csv",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(h)}const q=re("popUpManager");function te(s){const e=D.value[s]||[];return["/dea/event_detail/#"].concat(e).join("/")}function se(s){q.value.addPopup(de(Ae),{circle_db:s,db_path:D.value[s.event_name]})}return le(async()=>{await H()}),(s,e)=>{var _,n,c,v,h,r,u,y,j;return l(),i(E,null,[t("head",null,[a.value[0]=="eEnabled"?(l(),i("title",je,`\r
      dea | Circle Participation (extensive search)\r
    `)):(l(),i("title",Ue,"dea | Circle Participation"))]),e[8]||(e[8]=t("div",{class:"header-title"},"Circle Participation",-1)),e[9]||(e[9]=t("div",{class:"header"},"List of participating circles in the database.",-1)),a.value[0]=="Loading"?(l(),i("div",Se," Loading circle index metadata... ")):a.value[0]=="Loaded"?(l(),i("div",Te," Successfully loaded circle index metadata. One of the circle indexes can now be downloaded. ")):g("",!0),a.value[0]=="cLoading"?(l(),i("div",Me," Loading Compact Circle Index... Downloaded "+m(a.value[1])+" / "+m((_=p.value)==null?void 0:_.compact_index_chunk_count)+"... ",1)):g("",!0),a.value[0]=="cParsing"?(l(),i("div",Ie," Parsing Compact Circle Index... Parsed "+m(a.value[1])+" / "+m((n=p.value)==null?void 0:n.compact_index_chunk_count)+"... ",1)):g("",!0),a.value[0]=="cLoaded"?(l(),i("div",Re," Successfully loaded Compact Circle Index. ")):g("",!0),a.value[0]=="eLoading"?(l(),i("div",De," Loading Extensive Circle Index... Downloaded "+m(a.value[1])+" / "+m((c=p.value)==null?void 0:c.extensive_index_chunk_count)+"... ",1)):g("",!0),a.value[0]=="eParsing"?(l(),i("div",Fe," Parsing Extensive Circle Index... Parsed "+m(a.value[1])+" / "+m((v=p.value)==null?void 0:v.extensive_index_chunk_count)+"... ",1)):g("",!0),a.value[0]=="eLoaded"?(l(),i("div",Ne," Successfully loaded Extensive Circle Index. ")):a.value[0].endsWith("Error")?(l(),i("div",Be,[S(" Failed to fetch "+m(a.value[0]=="cError"?"circle compact index":a.value[0]=="eError"?"circle extensive index":"circle index metadata")+". ",1),t("button",{class:"retry-button",onClick:e[0]||(e[0]=o=>a.value[0]=="Error"?H():a.value[0]=="cError"?A("compact"):A("extensive")),title:"Retry fetching circle compact index."}," Retry ")])):g("",!0),t("div",He,[t("div",Oe,[a.value[0]=="Loaded"?(l(),i("button",{key:0,class:"retry-button",onClick:e[1]||(e[1]=o=>A("compact")),title:`Load compact circle index (${((h=p.value)==null?void 0:h.compact_index_chunk_count)??0} chunks, ${Math.ceil((((r=p.value)==null?void 0:r.compact_total_size)||0)/1048576)} MB)`}," Compact circle index ",8,Ve)):g("",!0),a.value[0]=="Loaded"||a.value[0]=="cLoaded"?(l(),i("button",{key:1,class:"retry-button",onClick:e[2]||(e[2]=o=>A("extensive")),title:`Load extensive circle index (${((u=p.value)==null?void 0:u.extensive_index_chunk_count)??0} chunks, ${Math.ceil((((y=p.value)==null?void 0:y.extensive_total_size)||0)/1048576)} MB)`}," Extensive circle index ",8,qe)):g("",!0)]),t("div",ze,[t("button",{class:"ds-button",onClick:e[3]||(e[3]=o=>ee()),title:"Dump search results to csv."}," Dump search results ")])]),t("div",We,[t("div",Ge,[ce(t("input",{class:"cp-input","onUpdate:modelValue":e[4]||(e[4]=o=>d.value=o),onInput:Z,placeholder:"Keywords"},null,544),[[ie,d.value]]),t("div",Je,[e[6]||(e[6]=t("div",{class:"cp-regex-label"},"Use Regex ?",-1)),T(xe,{toggle_value:P.value,"onUpdate:toggle_value":e[5]||(e[5]=o=>P.value=o),titleFunc:o=>o?"regex search enabled":"regex search disabled"},null,8,["toggle_value","titleFunc"])]),t("div",Ke,"("+m((j=w.value)==null?void 0:j.length)+" results)",1)]),e[7]||(e[7]=t("table",{class:"cp-header-table"},[t("thead",null,[t("tr",null,[t("th",{colspan:"4",class:"cp-table-title"},"Participating circles")]),t("tr",null,[t("th",null,"Names / Pen Names"),t("th",null,"Event")])])],-1)),t("div",Xe,[t("div",z(U(X),{class:"cp-vlist-component"}),[t("div",z(U(Y),{class:"cp-vlist-wrapper"}),[(l(!0),i(E,null,B(U(K),o=>(l(),i("div",{key:o.index,class:ue([["cp-vlist-item",o.index%2===0?"cp-vlist-item-even":"cp-vlist-item-odd"],"cp-row"]),style:oe({transform:`translateY(${o.start}px)`,height:"22px",willChange:"transform"})},[t("div",Ye,[t("div",Qe,[t("button",{class:"cp-popup-button",onClick:lt=>se(o.data),title:"Show circle (partial) details"}," ðŸ¡µ ",8,Ze),S(" "+m(Array.isArray(o.data.names)?o.data.names.join(" / "):o.data.names||""),1)]),t("div",et,[t("a",{class:"cp-event-link",href:te(o.data.event_name)},m(o.data.event_name),9,tt)])])],6))),128))],16)],16)])]),T(ye,{ref_key:"popUpManager",ref:q},null,512)],64)}}},nt=G(at,[["__scopeId","data-v-21878935"]]),rt={__name:"App",setup(x){return(L,d)=>(l(),i(E,null,[T(ve),T(nt)],64))}};pe(rt).mount("#app");
