import{l as q,D as pe,J as fe,K as _e,L as Q,g as $,v as V,k as M,B as G,M as Y,_ as K,j as me,o as _,w as he,a as o,c as h,h as T,b as U,t as P,F as O,i as N,u as z,H as ge,O as ye,n as xe,d as H,P as be,Q as we,R as ke,S as Le,q as Ce,N as Pe,e as $e}from"./Navigation-yYuU6Nma.js";import{m as Ee,f as Re,P as W,i as J,b as Ae}from"./axios_config-yEhEWjiR.js";import{P as Te,a as Me}from"./PopUpGeneric-Byk2JCZB.js";function Se(e){return fe()?(_e(e),!0):!1}const je=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;function De(e){return Array.isArray(e)?e:[e]}function Be(e){return Q()}function Fe(e,s=!0,n){Be()?q(e,n):s?e():pe(e)}const Z=je?window:void 0;function j(e){var s;const n=Y(e);return(s=n==null?void 0:n.$el)!=null?s:n}function Ue(){const e=V(!1),s=Q();return s&&q(()=>{e.value=!0},s),e}function Ve(e){const s=Ue();return $(()=>(s.value,!!e()))}function Oe(e,s,n={}){const{window:r=Z,...a}=n;let l;const i=Ve(()=>r&&"ResizeObserver"in r),t=()=>{l&&(l.disconnect(),l=void 0)},m=$(()=>{const u=Y(e);return Array.isArray(u)?u.map(g=>j(g)):[j(u)]}),b=G(m,u=>{if(t(),i.value&&r){l=new ResizeObserver(s);for(const g of u)g&&l.observe(g,a)}},{immediate:!0,flush:"post"}),L=()=>{t(),b()};return Se(L),{isSupported:i,stop:L}}function Ie(e,s={width:0,height:0},n={}){const{window:r=Z,box:a="content-box"}=n,l=$(()=>{var u,g;return(g=(u=j(e))==null?void 0:u.namespaceURI)==null?void 0:g.includes("svg")}),i=V(s.width),t=V(s.height),{stop:m}=Oe(e,([u])=>{const g=a==="border-box"?u.borderBoxSize:a==="content-box"?u.contentBoxSize:u.devicePixelContentBoxSize;if(r&&l.value){const f=j(e);if(f){const w=f.getBoundingClientRect();i.value=w.width,t.value=w.height}}else if(g){const f=De(g);i.value=f.reduce((w,{inlineSize:k})=>w+k,0),t.value=f.reduce((w,{blockSize:k})=>w+k,0)}else i.value=u.contentRect.width,t.value=u.contentRect.height},n);Fe(()=>{const u=j(e);u&&(i.value="offsetWidth"in u?u.offsetWidth:s.width,t.value="offsetHeight"in u?u.offsetHeight:s.height)});const b=G(()=>j(e),u=>{i.value=u?s.width:0,t.value=u?s.height:0});function L(){m(),b()}return{width:i,height:t,stop:L}}function ze(e,s){const{containerStyle:n,wrapperProps:r,scrollTo:a,calculateRange:l,currentList:i,containerRef:t}="itemHeight"in s?Ne(s,e):We(s,e);return{list:i,scrollTo:a,containerProps:{ref:t,onScroll:()=>{l()},style:n},wrapperProps:r}}function ee(e){const s=V(null),n=Ie(s),r=M([]),a=V(e);return{state:M({start:0,end:10}),source:a,currentList:r,size:n,containerRef:s}}function te(e,s,n){return r=>{if(typeof n=="number")return Math.ceil(r/n);const{start:a=0}=e.value;let l=0,i=0;for(let t=a;t<s.value.length;t++){const m=n(t);if(l+=m,i=t,l>r)break}return i-a}}function ne(e,s){return n=>{if(typeof s=="number")return Math.floor(n/s)+1;let r=0,a=0;for(let l=0;l<e.value.length;l++){const i=s(l);if(r+=i,r>=n){a=l;break}}return a+1}}function se(e,s,n,r,{containerRef:a,state:l,currentList:i,source:t}){return()=>{const m=a.value;if(m){const b=n(e==="vertical"?m.scrollTop:m.scrollLeft),L=r(e==="vertical"?m.clientHeight:m.clientWidth),u=b-s,g=b+L+s;l.value={start:u<0?0:u,end:g>t.value.length?t.value.length:g},i.value=t.value.slice(l.value.start,l.value.end).map((f,w)=>({data:f,index:w+l.value.start}))}}}function ae(e,s){return n=>typeof e=="number"?n*e:s.value.slice(0,n).reduce((a,l,i)=>a+e(i),0)}function oe(e,s,n,r){G([e.width,e.height,s,n],()=>{r()})}function re(e,s){return $(()=>typeof e=="number"?s.value.length*e:s.value.reduce((n,r,a)=>n+e(a),0))}const He={horizontal:"scrollLeft",vertical:"scrollTop"};function le(e,s,n,r){return a=>{r.value&&(r.value[He[e]]=n(a),s())}}function We(e,s){const n=ee(s),{state:r,source:a,currentList:l,size:i,containerRef:t}=n,m={overflowX:"auto"},{itemWidth:b,overscan:L=5}=e,u=te(r,a,b),g=ne(a,b),f=se("horizontal",L,g,u,n),w=ae(b,a),k=$(()=>w(r.value.start)),D=re(b,a);oe(i,s,t,f);const B=le("horizontal",f,w,t),F=$(()=>({style:{height:"100%",width:`${D.value-k.value}px`,marginLeft:`${k.value}px`,display:"flex"}}));return{scrollTo:B,calculateRange:f,wrapperProps:F,containerStyle:m,currentList:l,containerRef:t}}function Ne(e,s){const n=ee(s),{state:r,source:a,currentList:l,size:i,containerRef:t}=n,m={overflowY:"auto"},{itemHeight:b,overscan:L=5}=e,u=te(r,a,b),g=ne(a,b),f=se("vertical",L,g,u,n),w=ae(b,a),k=$(()=>w(r.value.start)),D=re(b,a);oe(i,s,t,f);const B=le("vertical",f,w,t),F=$(()=>({style:{width:"100%",height:`${D.value-k.value}px`,marginTop:`${k.value}px`}}));return{calculateRange:f,scrollTo:B,containerStyle:m,wrapperProps:F,currentList:l,containerRef:t}}const qe={class:"popup-circle-div"},Ge={class:"cd-aliases"},Ke={class:"cd-event"},Xe=["href"],Je={key:0,class:"cd-misc"},Qe={class:"cd-ul-descriptions"},Ye=["innerHTML"],Ze={__name:"PopUpCirclePartialdetails",props:{circle_db:{type:Object,required:!0},db_path:{type:Array,required:!0}},setup(e){return(s,n)=>(_(),me(Te,{onClose:n[0]||(n[0]=r=>s.$emit("close")),title:`Circle Partial Details: ${e.circle_db.names[0]||"undefined"}`},{default:he(()=>{var r,a;return[o("div",qe,[o("p",Ge,[n[1]||(n[1]=o("span",{class:"info-name"},"Names:",-1)),U(" "+P((a=(r=e.circle_db)==null?void 0:r.names)==null?void 0:a.join(" / ")),1)]),o("p",Ke,[n[2]||(n[2]=o("span",{class:"info-name"},"Event:",-1)),U(" "+P()+" ",1),o("a",{class:"cd-event-link",href:["/dea/event_detail/#"].concat(e.circle_db.ar_path).join("/")},P(e.circle_db.event_name),9,Xe)]),e.circle_db.hasOwnProperty("misc")&&e.circle_db.misc.length>0?(_(),h("div",Je,[n[3]||(n[3]=o("span",{class:"info-name"},"Misc:",-1)),o("ul",Qe,[(_(!0),h(O,null,N(e.circle_db.misc,(l,i)=>(_(),h("span",{key:i},[(_(!0),h(O,null,N(l.split(`
`),(t,m)=>(_(),h("li",{key:m},[o("span",{innerHTML:z(Ee)(t)},null,8,Ye)]))),128))]))),128))])])):T("",!0),n[4]||(n[4]=o("p",null,"Note: search results matches for any fields described above.",-1)),n[5]||(n[5]=o("p",null,"For more details, please refer to event detail page.",-1))])]}),_:1},8,["title"]))}},et=K(Ze,[["__scopeId","data-v-79b522a1"]]),tt=["id","title"],nt=["id"],st={__name:"ToggleSwitch",props:{toggle_value:{type:Boolean,required:!0},id:{type:String,required:!1,default:null},titleFunc:{type:Function,required:!1,default:e=>"Switch is "+(e?"Enabled":"Disabled")}},emits:["update:toggle_value"],setup(e,{emit:s}){const n=e,r=s,a=$({get:()=>n.toggle_value,set:i=>r("update:toggle_value",i)}),l=$(()=>n.titleFunc(a.value));return(i,t)=>(_(),h("label",{class:"switch",id:e.id,title:l.value},[ge(o("input",{id:e.id,type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=m=>a.value=m)},null,8,nt),[[ye,a.value]]),t[1]||(t[1]=o("span",{class:"slider round"},null,-1))],8,tt))}},at=K(st,[["__scopeId","data-v-5cc34991"]]),ot={key:0},rt={key:1},lt={key:0,class:"status-message"},ct={key:1,class:"status-message"},it={key:2,class:"status-message"},ut={key:3,class:"status-message"},dt={key:4,class:"status-message"},vt={key:5,class:"status-message"},pt={key:6,class:"status-message"},ft={key:7,class:"status-message"},_t={key:8,class:"status-message"},mt={key:9,class:"status-message"},ht=["title"],gt={key:10,class:"status-message"},yt=["title"],xt=["value"],bt={class:"cp-div"},wt={class:"cp-vlist"},kt=["onClick"],Lt=["href"],Ct={__name:"CircleParticipation",setup(e){const s=M(""),n=M({}),r=M([]),a=M([]),l=M([]),i=M([]),t=M(["Idle"]),m=M(!1);async function b(){Re({url:[W].concat(["circle_index_metadata.json"]).join("/"),axiosInstance:J,on_start:()=>{n.value={},t.value=["Loading"]},on_success:c=>{n.value=c,t.value=["Loaded"]},on_error:c=>{t.value=["Error"]}})}async function L(c){var R,A;let d="",E=0,v=null,p=null;if(c=="compact")v=r,p=l,d=[W].concat(["circle_participation_compact_index"]).join("/"),E=((R=n.value)==null?void 0:R.compact_index_chunk_count)||0,t.value=["cLoading",0];else if(c=="extensive")v=a,p=i,d=[W].concat(["circle_participation_extensive_index"]).join("/"),E=((A=n.value)==null?void 0:A.extensive_index_chunk_count)||0,t.value=["eLoading",0];else{console.error("fetch_circle_raw_indexes: Unknown variant",c);return}v.value=[],v.value.length>0&&console.log(`Retrying from ${v.value.length} / ${E} for ${c} index.`);for(let y=v.value.length;y<E;y++){let x=`${d}_${y}.json`;try{const S=await J.get(x,{responseType:"json"});t.value[1]=y+1,console.log(`NEW FETCHED: (${x})`),v.value.push(S.data)}catch(S){t.value=[c=="compact"?"cError":"eError"],console.error("Error fetching data:",S);return}}t.value=[c=="compact"?"cParsing":"eParsing",0],await Ae(1e3),p.value=[];for(let y=0;y<v.value.length;y++)p.value=p.value.concat(u(v.value[y],[],c)),t.value[1]=y+1;t.value=[c=="compact"?"cLoaded":"eLoaded"]}function u(c,d=[],E="compact"){let v=[];for(const p in c)if(Array.isArray(c[p])){let R=[];for(const A in c[p]){let y=c[p][A],x=E=="extensive"?y:{names:y};x.ar_path=d.concat(p),x.event_name=p,R.push(x)}v=[].concat(v,R)}else{let R=u(c[p],d.concat(p),E);v=[].concat(v,R)}return v}const g=$(()=>{try{return new RegExp(s.value,"i")}catch{return null}}),f=$(()=>t.value[0]==="cLoaded"&&l&&l.value&&Array.isArray(l.value)?l.value:t.value[0]==="eLoaded"&&i&&i.value&&Array.isArray(i.value)?i.value:[]),w=$(()=>!f||!f.value||!Array.isArray(f.value)?[]:f.value.map(c=>({...c,names:c.names.map(d=>d.trim().toLowerCase()),misc:c.misc&&Array.isArray(c.misc)?c.misc.map(d=>d.trim().toLowerCase()):null,event_name:c.event_name.trim().toLowerCase()}))),k=$(()=>{if(!f||!f.value||!Array.isArray(f.value))return[];let c=s.value.trim().toLowerCase();return f.value.filter((d,E)=>{let v=w.value[E];return m.value&&c.length>0?g.value?v.names.some(p=>g.value.test(p))||g.value.test(v.event_name)||v.misc&&v.misc.some(p=>g.value.test(p)):!1:v.names.some(p=>p.includes(c))||v.event_name.toLowerCase().includes(c)||v.misc&&v.misc.some(p=>p.toLowerCase().includes(c))})}),{list:D,containerProps:B,wrapperProps:F,scrollTo:ce}=ze(k,{itemHeight:10});function ie(c){s.value=c.target.value,ce(0)}function ue(){if(!k||!k.value||k.value.length===0)return;const c=k.value||[];function d(x){return x==null?"":`"${String(x).replace(/"/g,'""').replace(/\t/g,"\\t").replace(/\r?\n/g,"\\n")}"`}const v=[["event_name","names","misc"].join("	")];for(const x of c){const S=x.event_name??"",I=Array.isArray(x.names)?x.names.join(" / "):x.names??"",C=Array.isArray(x.misc)?x.misc.join(" / "):x.misc??"";v.push([d(S),d(I),d(C)].join("	"))}const p=v.join(`\r
`),R=new Blob(["\uFEFF",p],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(R),y=document.createElement("a");y.href=A,y.download="circle_search_dump.csv",document.body.appendChild(y),y.click(),y.remove(),URL.revokeObjectURL(A)}const X=xe("popUpManager");function de(c){X.value.addPopup(Ce(et),{circle_db:c,db_path:c.ar_path})}return q(async()=>{await b()}),(c,d)=>{var E,v,p,R,A,y,x,S,I;return _(),h(O,null,[o("head",null,[t.value[0]=="eEnabled"?(_(),h("title",ot,`\r
      dea | Circle Participation (extensive search)\r
    `)):(_(),h("title",rt,"dea | Circle Participation"))]),d[6]||(d[6]=o("div",{class:"header-title"},"Circle Participation",-1)),d[7]||(d[7]=o("div",{class:"header"},"List of participating circles in the database.",-1)),t.value[0]=="Loading"?(_(),h("div",lt," Loading circle index metadata... ")):t.value[0]=="Loaded"?(_(),h("div",ct," Successfully loaded circle index metadata. ")):T("",!0),t.value[0]=="cLoading"?(_(),h("div",it," Loading Compact Circle Index... Downloaded "+P(t.value[1])+" / "+P((E=n.value)==null?void 0:E.compact_index_chunk_count)+"... ",1)):T("",!0),t.value[0]=="cParsing"?(_(),h("div",ut," Parsing Compact Circle Index... Parsed "+P(t.value[1])+" / "+P((v=n.value)==null?void 0:v.extensive_index_chunk_count)+"... ",1)):T("",!0),t.value[0]=="cLoaded"?(_(),h("div",dt," Successfully loaded Compact Circle Index. ")):T("",!0),t.value[0]=="eLoading"?(_(),h("div",vt," Loading Extensive Circle Index... Downloaded "+P(t.value[1])+" / "+P((p=n.value)==null?void 0:p.extensive_index_chunk_count)+"... ",1)):T("",!0),t.value[0]=="eParsing"?(_(),h("div",pt," Parsing Extensive Circle Index... Parsed "+P(t.value[1])+" / "+P((R=n.value)==null?void 0:R.extensive_index_chunk_count)+"... ",1)):T("",!0),t.value[0]=="eLoaded"?(_(),h("div",ft," Successfully loaded Extensive Circle Index. ")):t.value[0].endsWith("Error")?(_(),h("div",_t,[U(" Failed to fetch "+P(t.value[0]=="cError"?"circle compact index":t.value[0]=="eError"?"circle extensive index":"circle index metadata")+". ",1),o("button",{class:"retry-button",onClick:d[0]||(d[0]=C=>t.value[0]=="Error"?b():t.value[0]=="cError"?L("compact"):L("extensive")),title:"Retry fetching circle compact index."}," Retry ")])):T("",!0),t.value[0]=="Loaded"?(_(),h("div",mt,[o("button",{class:"retry-button",onClick:d[1]||(d[1]=C=>L("compact")),title:`Load compact circle index (${((A=n.value)==null?void 0:A.compact_index_chunk_count)??0} chunks, ${Math.ceil((((y=n.value)==null?void 0:y.compact_total_size)||0)/1048576)} MB)`}," Compact circle index ",8,ht)])):T("",!0),t.value[0]=="Loaded"||t.value[0]=="cLoaded"?(_(),h("div",gt,[o("button",{class:"retry-button",onClick:d[2]||(d[2]=C=>L("extensive")),title:`Load extensive circle index (${((x=n.value)==null?void 0:x.extensive_index_chunk_count)??0} chunks, ${Math.ceil((((S=n.value)==null?void 0:S.extensive_total_size)||0)/1048576)} MB)`}," Extensive circle index ",8,yt)])):T("",!0),o("input",{class:"cp-input",value:s.value,onInput:ie,placeholder:"Keywords"},null,40,xt),H(at,{toggle_value:m.value,"onUpdate:toggle_value":d[3]||(d[3]=C=>m.value=C),titleFunc:C=>C?"regex search enabled":"regex search disabled"},null,8,["toggle_value","titleFunc"]),U(" ("+P((I=k.value)==null?void 0:I.length)+" results) ",1),o("button",{class:"ds-button",onClick:d[4]||(d[4]=C=>ue()),title:"Dump search results to csv.",style:{float:"right","margin-right":"1.5em"}}," Dump search results "),o("div",bt,[d[5]||(d[5]=o("table",{class:"cp-header-table"},[o("thead",null,[o("tr",null,[o("th",{colspan:"4",class:"cp-table-title"},"Participating circles")]),o("tr",null,[o("th",null,"Names / Pen Names"),o("th",null,"Event")])])],-1)),o("div",wt,[o("div",be(z(B),{class:"cp-vlist-component"}),[o("div",we(ke(z(F))),[(_(!0),h(O,null,N(z(D),(C,ve)=>(_(),h("div",{key:ve,class:"cp-vlist-item"},[o("div",{class:Le(C.index%2===0?"cp-vlist-item-even":"cp-vlist-item-odd")},[o("table",null,[o("tbody",null,[o("tr",null,[o("th",null,[o("button",{class:"cp-popup-button",onClick:Et=>de(C.data),title:"Show circle (partial) details"}," 🡵 ",8,kt),U(" "+P(C.data.names.join(" / ")),1)]),o("th",null,[o("a",{class:"cp-event-link",href:["/dea/event_detail/#"].concat(C.data.ar_path).join("/")},P(C.data.event_name),9,Lt)])])])])],2)]))),128))],16)],16)])]),H(Me,{ref_key:"popUpManager",ref:X},null,512)],64)}}},Pt=K(Ct,[["__scopeId","data-v-34a388ac"]]),$t={__name:"App",setup(e){return(s,n)=>(_(),h(O,null,[H(Pe),H(Pt)],64))}};$e($t).mount("#app");
