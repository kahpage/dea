import{k as M,g as m,D as Y,H as Z,l as N,c as i,o as s,a as o,d as R,N as tt,b as w,F as v,i as k,I as et,K as nt,v as at,t as d,w as P,j as L,h as g,s as z,u as b,e as rt}from"./Navigation-Dx91ZCbe.js";import{b as A,a as S,f as st,P as ot,i as it}from"./axios_config-BOxkkDfg.js";import{T as $}from"./ToggleShow-BPFzjegt.js";import{B as lt}from"./BarChart-DnUCAeyz.js";const ct={class:"vf-container"},dt={class:"vf-content"},ut={key:0,class:"status-message"},_t={key:1,class:"status-message"},ht={key:2},vt={class:"legend-container"},ft=["id","onUpdate:modelValue"],pt=["href"],yt={style:{display:"flex",gap:"0.75em","align-items":"center","justify-content":"center","margin-top":"0.5em"}},mt={style:{color:"var(--grey-mild)","font-size":"0.95em","margin-left":"0.5em"}},kt={class:"vf-eg-name-container"},bt=["href"],St={class:"vf-eg-content"},gt={key:0,class:"status-message"},jt={class:"vf-eg-name-container"},xt=["href"],Ct=["onClick"],Et=["title"],Ot={class:"vf-eg-content"},wt={key:0,class:"error-text"},At={key:1,class:"media-container"},Vt={class:"media-table"},Bt={key:"group-header"},Mt=["title"],Rt=["href"],Tt=["title"],Gt={key:0,class:"media-item"},Dt={key:0},It={key:0},Ft=["src","onError","title"],Pt=["title"],zt={key:1},$t=["href","title"],Lt={key:0,class:"media-item"},Ut={key:0},Ht={key:0},Jt=["src","onError","title"],Xt=["title"],Kt={key:1},qt=["href","title"],Qt={__name:"Verify",setup(U){const f=M({}),p=M("loading");async function T(){st({url:[ot].concat("verify_index.json").join("/"),axiosInstance:it,on_start:()=>{f.value={},p.value="loading"},on_success:e=>{f.value=e,p.value="loaded"},on_error:e=>{p.value="error"}})}function G(e,a=[]){let t=[],n=Object.keys(e).filter(l=>l!=="@databases"&&l!=="@count");n.sort((l,c)=>l.localeCompare(c));let r=e["@databases"]||{};const _=Object.entries(r).sort(([,l],[,c])=>{const O=l&&l.key||"",W=c&&c.key||"";return O.localeCompare(W)});for(const[l,c]of _){let O=a.concat([l]);O.join("/"),c.ar_path=O,t.push(c)}for(const l of n){const c=G(f.value[l],a.concat([l]));t=t.concat(c)}return t}const D=m(()=>G(f.value)),j=m(()=>{const e=D.value,a=e.length;return e.map((t,n)=>{const r=t.ar_path?t.ar_path.join("/"):"";return{...t,pathStr:r,link:"/dea/event_group_detail/#/"+r,hue:a>0?360*n/a:0}})}),h=M({});Y(j,e=>{if(e)for(const a of e)a.pathStr in h.value||(h.value[a.pathStr]=!0)},{immediate:!0});function I(e){const a=j.value||[];for(const t of a)h.value[t.pathStr]=e}function H(){I(!0)}function J(){I(!1)}const X=m(()=>j.value.map(e=>({name:e.name,hue:e.hue,link:e.link,pathStr:e.pathStr}))),V=m(()=>j.value.filter(e=>h.value[e.pathStr]));m(()=>(console.log("Flattened verify list:",f.value),D.value));const K=m(()=>V.value.length);function q(e){if(!e||!e.events)return 0;const a=Object.values(e.events).map(t=>t.media?t.media.length:0);return a.push(e.media?e.media.length:0),Math.max(0,...a)}const x=Z({});function C(e){x[e]=!0}function F(e){return!!x[e]}function y(e){if(typeof e=="string")return e.split("/").pop();if(!e&&e!==0)return"";if(Array.isArray(e))return e.map(String).join("/");if(typeof e=="object"){if(e.name)return String(e.name);try{return JSON.stringify(e)}catch{return String(e)}}return String(e)}function B(e){if(typeof e=="string")return e;if(!e&&e!==0)return"";if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return String(e)}function u(e,a=null){let t=0;if(a===null){if(!e.media)return 0;for(let r=0;r<e.media.length;r++)x[e.pathStr+"::group::"+r]&&t++;return t}const n=e.events&&e.events[a];if(!n||!n.media)return 0;for(let r=0;r<n.media.length;r++)x[e.pathStr+"::"+a+"::"+r]&&t++;return t}function E(e){let a=u(e);return e.events&&Object.keys(e.events).forEach(t=>{a+=u(e,t)}),a}function Q(e){e.media&&e.media.length>0&&e.media.forEach((a,t)=>{const n=typeof a=="string"?a:a==null?void 0:a.path;if(!n||!A(n))return;const r=S+"/"+e.ar_path.concat(["media"]).join("/")+"/"+n,_=new Image;_.onload=()=>{},_.onerror=()=>{C(e.pathStr+"::group::"+t)},_.src=r}),e.events&&Object.keys(e.events).forEach(a=>{const t=e.events[a];!t.media||t.media.length===0||t.media.forEach((n,r)=>{const _=typeof n=="string"?n:n==null?void 0:n.path;if(!_||!A(_))return;const l=S+"/"+e.ar_path.concat(["media"]).join("/")+"/"+_,c=new Image;c.onload=()=>{},c.onerror=()=>{C(e.pathStr+"::"+a+"::"+r)},c.src=l})})}return N(async()=>{await T()}),(e,a)=>(s(),i(v,null,[a[7]||(a[7]=o("head",null,[o("title",null,"dea | Verify")],-1)),o("div",ct,[o("div",dt,[a[4]||(a[4]=o("section",{id:"top"},null,-1)),R(tt),a[5]||(a[5]=o("div",{class:"header-title"},"Verify",-1)),a[6]||(a[6]=o("div",{class:"header"}," Various tools for database verification and visualization. ",-1)),p.value==="loading"?(s(),i("div",ut," Fetching verify db... ")):p.value==="error"?(s(),i("div",_t,[a[0]||(a[0]=w(" Failed to fetch verify db. ")),o("button",{class:"retry-button",onClick:T,title:"Retry fetching verify db."}," Retry ")])):(s(),i("div",ht,[o("div",vt,[(s(!0),i(v,null,k(X.value,t=>(s(),i("div",{key:t.pathStr,class:"legend-item"},[et(o("input",{type:"checkbox",id:"legend-"+t.pathStr,"onUpdate:modelValue":n=>h.value[t.pathStr]=n,class:"legend-checkbox",style:at({backgroundColor:h.value[t.pathStr]?`hsl(${t.hue}, var(--event-active-saturation), var(--event-lightness))`:"transparent",borderColor:`hsl(${t.hue}, var(--event-active-saturation), var(--event-lightness))`}),title:"Toggle visibility"},null,12,ft),[[nt,h.value[t.pathStr]]]),o("a",{href:t.link,class:"legend-text"},d(t.name),9,pt)]))),128))]),o("div",yt,[o("button",{class:"retry-button",onClick:H}," Show all "),o("button",{class:"retry-button",onClick:J}," Show none "),o("span",mt," Showing "+d(K.value)+" groups ",1)]),R($,{class:"vf-toggle-show",button_text:"Circle Participation Charts"},{default:P(()=>[(s(!0),i(v,null,k(V.value,t=>(s(),i("div",{class:"vf-eg-div",key:t.name},[o("div",kt,[o("a",{href:t.link,class:"vf-eg-name"},d(t.name),9,bt)]),o("div",St,[t.events?(s(),L(lt,{key:1,data:Object.keys(t.events).map(n=>{var r;return{value:t.events[n].circle_count,name:n,prefix:(r=t.events[n])==null?void 0:r.dates,url:["/dea/event_detail/#"].concat(t.ar_path||[]).concat([n]).join("/")}}),title:"Event participation"},null,8,["data"])):(s(),i("p",gt," No events in this event group. "))])]))),128))]),_:1}),a[2]||(a[2]=o("br",null,null,-1)),R($,{class:"vf-toggle-show",button_text:"Media"},{default:P(()=>[(s(!0),i(v,null,k(V.value,t=>(s(),i("div",{class:"vf-eg-div",key:t.name},[o("div",jt,[o("a",{href:t.link,class:"vf-eg-name"},d(t.name),9,xt),o("button",{class:"preload-button-vertical",onClick:n=>Q(t),title:"Preload all images of the event group"},"âŸ³",8,Ct),E(t)>0?(s(),i("span",{key:0,class:"error-count-vertical",title:E(t)+(E(t)===1?" total error":" total errors")},"("+d(E(t))+")",9,Et)):g("",!0)]),o("div",Ot,[t.events?(s(),i("div",At,[o("table",Vt,[o("thead",null,[o("tr",null,[o("th",Bt,[a[1]||(a[1]=w(" Event Group ")),u(t)>0?(s(),i("span",{key:0,class:"header-error-count",title:u(t)+(u(t)===1?" media loading error":" media loading errors")},"("+d(u(t))+")",9,Mt)):g("",!0)]),(s(!0),i(v,null,k(Object.keys(t.events),n=>(s(),i("th",{key:n},[o("a",{href:["/dea/event_detail/#"].concat(t.ar_path||[]).concat([n]).join("/")},d(n),9,Rt),u(t,n)>0?(s(),i("span",{key:0,class:"header-error-count",title:u(t,n)+(u(t,n)===1?" media loading error":" media loading errors")},"("+d(u(t,n))+")",9,Tt)):g("",!0)]))),128))])]),o("tbody",null,[(s(!0),i(v,null,k(q(t),n=>(s(),i("tr",{key:n},[(s(),i("td",{key:"group-"+n,class:z({"empty-cell":!t.media||!t.media[n-1]})},[t.media&&t.media[n-1]?(s(),i("div",Gt,[b(A)(t.media[n-1])?(s(),i("div",Dt,[F(t.pathStr+"::group::"+(n-1))?(s(),i("div",{key:1,class:"error-text",title:y(t.media[n-1])}," LOADING ERROR ",8,Pt)):(s(),i("div",It,[o("img",{src:b(S)+"/"+t.ar_path.concat(["media"]).join("/")+"/"+t.media[n-1],class:"media-image",loading:"lazy",onError:r=>C(t.pathStr+"::group::"+(n-1)),title:y(t.media[n-1])},null,40,Ft)])),w(" "+d(B(t.media[n-1])),1)])):(s(),i("div",zt,[o("a",{href:b(S)+"/"+t.ar_path.concat(["media"]).join("/")+"/"+t.media[n-1],target:"_blank",title:y(t.media[n-1])},d(t.media[n-1]),9,$t)]))])):g("",!0)],2)),(s(!0),i(v,null,k(Object.keys(t.events),r=>(s(),i("td",{key:r,class:z({"empty-cell":!t.events[r].media||!t.events[r].media[n-1]})},[t.events[r].media&&t.events[r].media[n-1]?(s(),i("div",Lt,[b(A)(t.events[r].media[n-1])?(s(),i("div",Ut,[F(t.pathStr+"::"+r+"::"+(n-1))?(s(),i("div",{key:1,class:"error-text",title:y(t.events[r].media[n-1])}," LOADING ERROR ",8,Xt)):(s(),i("div",Ht,[o("img",{src:b(S)+"/"+t.ar_path.concat(["media"]).join("/")+"/"+t.events[r].media[n-1],class:"media-image",loading:"lazy",onError:_=>C(t.pathStr+"::"+r+"::"+(n-1)),title:y(t.events[r].media[n-1])},null,40,Jt)])),w(" "+d(B(t.events[r].media[n-1])),1)])):(s(),i("div",Kt,[o("a",{href:b(S)+"/"+t.ar_path.concat(["media"]).join("/")+"/"+t.events[r].media[n-1],target:"_blank",title:y(t.events[r].media[n-1])},d(B(t.events[r].media[n-1])),9,qt)]))])):g("",!0)],2))),128))]))),128))])])])):(s(),i("p",wt," No events in this event group. "))])]))),128))]),_:1}),a[3]||(a[3]=o("br",null,null,-1))]))])])],64))}},Wt={__name:"App",setup(U){return(f,p)=>(s(),L(Qt))}};rt(Wt).mount("#app");
